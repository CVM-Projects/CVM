;; test.cms

.program
    .entry main

.datas
    .array  #1, 0x12 0x34 0x56
    .string #2, "Hello World!\n"
    .data   #3, 5
    .data   #4, 6

.func Math#add ;; (cms#int64 cms#int64) -> cms#int64
    .res cms#int64
    .stvarb 2, cms#int64
    .arg 2
    db_opreg
    call %res, cms#int64#+, %1 %2
    ret

.func print-hello
    .dyvarb 0
    .stvarb 1, cms#pointer
    .arg 0
    loadp %1, #2
    call %0, print_string, %1
    ret

.func main
    .dyvarb 2
    .stvarb 4, cms#int64
    .stvarb 1, cms#pointer
    .stvarb 1, cms#int64
    db_opreg
    load %1, #1, cms#int64
    db_opreg
    mov  %2, %1
    mov  %3, %1
    mov  %4, %1
    db_opreg
    load %5, #3, cms#int64
    load %6, #4, cms#int64
    load %8, 0, cms#int64
    db_opreg
    loadp %7, #2
    db_opreg
    call %0, print-hello
    call %0, print_int64, %5
    call %0, print_int64, %6
    call %0, print_int64, %8
    call %8, Math#add, %5 %6
    call %0, print_int64, %8
    jump #line1
    call %0, print-hello
    call %0, print-hello
    call %0, print-hello
    call %0, print-hello
    call %0, print-hello
#line1
    call %0, print-hello
    ret
    